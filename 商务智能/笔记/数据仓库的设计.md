# 数据仓库的设计

### 1、由来

- 事务型数据处理需要设计数据库，分析型中设计数据仓库的原理也一样
- 于是可以借鉴数据库设计
- 但具体的设计中也存在不少差别
- 面向OLTP的数据库设计有明确应用需求，系统生命周期各个阶段都有明确任务
- 而建造数据仓库时，有两部分
  - ETL：与操**作型系统接口**的设计
  - **数据仓库本身**设计

- 另一方面，数据仓库的需求只有在**已经装载部分数据的时候**才会清楚
  - 于是传统的**需求驱动**的设计方式不能应用于数据仓库设计

### 2、操作型数据库 vs 数据仓库

- 面向应用  面向分析
- 确定的应用需求  不确定的分析需求
- 设计目标：事务处理性能  **全局一致的数据环境**
- 数据来源：事务相关  多种多样
- 系统设计方法
  - SDLC:先收集和分析**应用需求**
  - CLDS:先**收集数据**，再开始建模、集成

### 3、数据仓库设计原则

- 数据仓库：面向主题、集成的、非易失的、时变的
- 设计过程三条原则
  - 面向主题
    - **主题：用户决策的主观需求**
    - 首先确定分析的主题，以此为起点进行相关数据的设计
    - 例如商品销售主题，目的：**适当**时候订购**适当**商品发到**适当**商店销售
      - 需要分析：如商品销售额与商品类型的关系
      - 管理人员据此决定经营策略
  - 数据驱动
    - 数据必须**从已有的数据源抽取**过来
      - 是已存在的数据 或者 已存在数据的加工处理后的结果
    - 解释“数据驱动”
      - 从**已有数据库**系统触发
      - 按照**分析领域**对**数据和数据间的联系**重新**考察**
      - 利用**数据模型**，有效识别原有**数据库**中的数据和**数据仓库**中的主题数据的**共同性**
  - 原型法设计原则
    - 问题：数据仓库的**原始需求不明确**，并在变化和增加
      - 因为用户的需求往往是个大方向，需求预见不准确
      - 原型法开发：从**构建系统基本架构**入手，不断完善系统
    - 为什么使用**逐步求精的设计过程**：
      - 数据仓库**用户的需求**不断细化和明确
      - 数据仓库**系统的开发**也是不断循环、反馈，使得系统不断完善的过程
      - 数据仓库开发的整个过程，要求决策人员和开发者**共同参与合作**，减少无效重复工作
    - 使用启发方式
      - 一个迭代开发依赖于上一个迭代的结果
      - 先载入一部分数据使用，根据用户的反馈，修改数据/添加数据
      - 上一步在整个开发周期贯穿反复
    - 也需要一定的需求预测

### 4、从操作型数据开始

- 数据从 操作型环境 移到 数据仓库环境，**不是简单抽取**
- 操作型系统中数据 会有**集成问题**
  - 相同数据不同单位，相同数据出现各个地方，等
- 从操作型环境到数据仓库的装载工作：ppt06 19
- 要考虑存取操作型数据的效率

### 5、过程/数据模型 与 设计环境

ppt06 22-25

- 强调数据模型的重要性
- 强调迭代开发重要性：因为**刚开始需求不明确**
- 强调每一遍开发中，数据模型的路标作用
  - 不同遍次的开发 要**基于相同的数据模型**

### 6、数据仓库设计的三级数据模型

- 概念模型：E-R
- 逻辑模型：关系模型
- 物理模型：逻辑模型在数据仓库的实现



- 高级模型：数据抽象程度最大，E-R
- 中级模型：数据项(dis-data item set)是E-R图的细分，E-R图中每个实体对应一个dis
- 低级模型：物理数据模型

### 7、数据仓库设计步骤

- 系统规划：**明确主题**，技术准备
- 概念设计
- 逻辑设计
- 物理设计
- 数据仓库生成
- 数据仓库的运行与维护

##### 明确主题

- 确定具体领域的分析对象--主题
- 对主题的认识是一个逐步完善的过程--原型设计法

##### 技术准备

- 技术评估：对数据仓库的性能指标，做一个评估，比如数据存储、重组、装载的能力
- 技术环境准备：数据仓库的软硬件平台要求

##### 概念模型设计

- 确定系统边界
  - 要做的**决策**类型
  - 决策者对什么**问题**感兴趣
  - 这些问题需要什么**信息**
  - 这些信息需要包含哪些**数据源**
- 确定主要的主题以及内容
  - 对每个主题的内容进行较详细的描述
    - 确定主题和属性信息
    - 各个属性的取值情况（固定不变的，半固定的，经常变的）
    - 确定主题的公共码键
    - 确定主题之间的关系
  - 然后用**实体联系模型E-R**，表示数据仓库的概念模型
- OLAP等分析应用的设计

##### 逻辑模型设计

- 将**E-R图**转成关系数据库的**二维表**
- 定义**数据源和数据抽取规则**
- 需要考虑以下问题
  - 适当的**粒度划分**
    - 原则：
      - **数据越详细，粒度越小，级别越低**
      - **数据综合度越高，粒度越大，级别越高**
    - 三种粒度
      - **详细数据、轻度总结、高度总结**
      - 或者采用更多级的粒度，比如时间跨度统计：天、周、月等
    - 粒度划分会影响
      - 数据量
      - 适合的查询类型
      - 于是影响数据库性能
    - 例如：
      - 细节数据有销售日期
        - 综合数据中有：天、周、月、季度、年的综合数据
      - 细节数据有商品号
        - 综合数据有：小类、大类
- 数据分割
  - 把**逻辑上是统一整体**的数据，分割成**较小的**，**可以独立管理的数据单元**，进行存储
  - 选择分割的因素：
    - 数据量大小，主题，数据分割标准，数据粒度划分策略
  - 通常采用“时间”属性，作为数据分割的依据
  - 分割技术类似于数据库的数据分片，目的是：**<u>提高数据仓库的性能</u>**

##### 物理模型设计

- 在逻辑模型设计的基础上
  - 确定数据的存储结构、确定索引策略、确定存储分配、数据存放位置
  - 这些物理有关的内容
- 物理模型设计的方法和数据库设计基本相似
  - 常用技术：合并表，冗余，表物理分割 等
- 规范化/反规范化
- 合并表：
  - **多表连接操作有大量I/O开销**
  - 可以把表中记录混合存放在一起
- 数据序列：
  - 创建一个数据序列
  - 如果数据存放在一行中，那么一次I/O可以检索到
  - **（具体的不太清楚，最好查一下）**
- 引入冗余
  - 某次面向主题的分析，会访问不同表的多个属性
  - 于是**每个属性，参与了很多主题的分析过程**
  - 可以把某些属性复制到多个不同的主题表中
  - 带来**大量数据冗余**，于是**一致性不是很好**
  - 但又因为数据仓库里面的**数据相对稳定**，**很少执行更新操作**
  - 最终**减少了**一次分析中，**需要访问的表数量**，提高了数据仓库的**性能**
- 表的物理分割
  - 可以根据每个属性数据的**访问频率和稳定性程度**，对**表的存储结构分割**
    - 访问**频率较高**的属性，**单独考虑物理存储**组织
      - 选合适**索引策略**和**物理组织**
    - 需要**频繁更新**的属性，也单独考虑
      - 以免**数据更新**带来的重组工作
- 生成导出数据
  - 在**原始细节数据**基础上，进行**统计和计算**，导出数据到数据仓库
  - 好处
    - 避免分析过程中执行**过多的统计和计算**，减少I/O，提高分析性能
    - 避免不同用户**重复统计操作可能的偏差**

- 建立**广义索引**
  - 记录数据仓库中，**与“最”相关**的统计结果
    - 比如当前**销售额最高**的商店
  - 这种广义索引数据量很小，可以在每次数据加载时生成
    - 用户直接从广义索引里面获取统计信息，**不用扫描整个仓库**

##### 数据仓库生成

- 建立数据模式
  - 根据**逻辑和物理设计的结果**
- 编写数据**抽取程序**
  - 根据数据仓库**元数据中的定义信息**，写程序，加工数据，形成仓库的数据
- 数据加载
  - 通过抽取程序加载

##### 数据仓库的使用与维护

- 数据仓库建立后，对此建立分析、决策的**应用系统**
- 在应用系统使用时，加深理解，**改进主题（原型法）**
- 系统运行过程中，数据源的数据不断变化，需要**数据刷新**，维护数据仓库**数据一致性**



















