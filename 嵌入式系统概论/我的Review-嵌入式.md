**总结**

# 一、复习

### 一、嵌入式系统的定义，特点，分类，典型应用。\*\*

#### 定义：

- 嵌入式系统是用于**控制、监视或者辅助**操作机器和设备的装置；  
- 是以**应用**为中心，以**计算机技术**为基础，软硬件可**裁剪**，适用于应用系统对功能、可靠性、成本、体积、功耗有严格要求的**专用**计算机系统  

#### 特点：

- 嵌入式系统通常是**形式多样、面向特定应用**的
- 嵌入式系统得到多种类型的**处理器**和**处理器体系结构**的支持
- 嵌入式系统通常机器关注**成本**
- 嵌入式系统有**实时性和可靠性**的要求
- 嵌入式系统使用的操作系统，一般是适应**多种处理器**、**可剪裁、轻量型、实施可靠、可固化**的嵌入式操作系统
- 嵌入式系统开发需要**专门的工具和特殊的方法**

#### 分类：

- 按照嵌入式处理器的位数来分类
  - 4/8/16/32/64位嵌入式系统
- 按照应用来分类
  - 信息家电、移动终端、工业控制、汽车电子、通信类
- 按速度分类
  - 强实时系统：系统响应时间在毫秒、微秒级
  - 一般实时系统：系统响应时间几秒数量级，比强实时系统差一些
  - 弱实时系统：系统响应时间数十秒或者更长，这种响应时间可能随着负载轻重而变化
- 按嵌入式系统软件复杂程度来分类
  - 循环轮询系统
  - 有限状态机系统
  - 前后台系统
  - 但处理器多任务系统
  - 多处理器多任务系统

#### 典型应用

- 生活运动：咕咚+，智能手表
- 智能家庭：小米路由、华为路由、360路由
- 健康医疗：智能体重秤、智能电子血压计
- 智能交通：特斯拉roadster，奔驰



### 二、嵌入式系统、IOT、CPS的基本组成\*\*。

#### 嵌入式系统的组成

- 嵌入式硬件 
  - 微处理器
  - 存储器
  - 系统专用的输入/输出设备

- 软件
  - 初始化代码及驱动
  - 嵌入式操作系统
  - 应用程序

#### CPS（cyber-physical system)的组成

- 传感器
- 嵌入式计算
- 云计算
- 网络通信
- 软件

#### IOT物联网的组成

- 物理设备（汽车，建筑物），电子设备
- 软件
- 传感器
- actuators执行器
- 网络连接（使这些对象收集和交换数据）

### 三、嵌入式系统设计

#### 嵌入式系统面临挑战

- 需要多少硬件
- 如何满足时限要求
- 如何降低系统功耗
- 如何设计以保证系统可升级
- 如何保证系统可靠地工作

#### 传统开发过程

- 需求分析
- 规格说明
- 体系结构
- 构件设计
- 系统集成

自顶向下设计，自底向上设计相结合

#### 软硬件协同设计 -

#### 软硬件划分

嵌入式系统中软件和硬件协同完成系统的功能

软件硬件划分通常由速度、灵活性以及开销来决策

嵌⼊式系统的设计涉及硬件与软件部件,设计中必须决定什么功能由硬件实现,什么功能由软件实现。

硬件和软件具有双重性

软硬件变动对系统的决策造成影响

划分和选择需要考虑多种因素

硬件和软件的双重性是划分决策的前提

软件实现的部分：

- 操作系统功能，包括任务调度，资源管理，设备驱动
- 协议栈，TCP/IP
- 应用软件框架
- 除基本系统、物理接口、基本逻辑电路，许多由硬件实现的功能都可以由软件实现

双重性部分：

- 算法，包括加密解密，编码解码，压缩解压
- 数学运算，浮点运算，FFT

### 四、嵌入式硬件系统基础

嵌入式系统的硬件是以嵌入式微处理器为核心，主要由嵌入式微处理器、总线、存储器、输入输出接口和设备组成

#### 4.1 嵌入式微处理器基础\*

##### 1、嵌入式微处理器体系结构

- 冯诺伊曼结构与哈佛结构
  - 冯诺依曼体系结构
    - 数据和程序放在同一存储空间中，统一编址，指令和数据通过同一个总线访问
  - 哈佛体系结构
    - 数据和程序不是放在同一个存储空间中，因此有两条总线，于是数据吞吐率是冯诺依曼结构的两倍

- CISC与RISC

  - |              | CISC                                                 | RISC                                                         |
    | ------------ | ---------------------------------------------------- | ------------------------------------------------------------ |
    | 价格         | 硬件完成部分软件功能，硬件复杂性高，成本高           | 软件完成部分功能，软件复杂性增加，芯片成本低                 |
    | 性能         | 减少代码尺寸，增加指令执行周期                       | 流水线技术，降低执行周期，增加代码尺寸                       |
    | 指令集       | 大量混杂指令，有简单快速的指令，也有复杂多周期的指令 | 简单的单周期指令                                             |
    | 高级语言支持 | 硬件完成                                             | 软件完成                                                     |
    | 寻址模式     | 复杂的寻址模式，支持内存到内存的寻址                 | 简单的寻址模式，只允许load和store指令存取内存，其他操作都是基于寄存器到寄存器 |
    | 寄存器数目   | 寄存器较少                                           | 寄存器较多                                                   |

- 流水线技术
  
  - RISC机器用来减少指令周期的一种技术，可以提高处理器和总线使用率
- 信息存储的字节顺序（大端和小端）
  
  - 小端就是高高低低，注意16进制两个数字存一个byte
- 分类（*）
  
  - 未完待续  
- 选型（*）
  
  - 未完待续

##### 2、ARM: 他说这里是--

- 前面的内容他说不考：工作状态、运行模式、寄存器结构、中断和异常

- 看门狗的功能及工作原理
  - 嵌入式控制系统运行时受到外部干扰或者系统错误，程序有时候会“跑飞”，导致整个系统瘫痪。为了在系统跑飞而进入死循环时，恢复系统的运行，加入看门狗电路
  - 基本原理：本系统程序完整运行一个周期的时间为tp，看门狗的定时周期为ti，ti>tp。在程序运行一周期后就修改计时器的计数值(就是重新设定周期)。程序运行正常的话计时器就不会溢出，若由于干扰使得系统不能在tp时刻修改定时器计数，定时器会在ti时刻溢出，引发系统复位，使得系统重新运行
- 看门狗定时器寄存器
  - 看门狗定时器控制寄存器WTCON
    - 通过该寄存器，可以使能/禁止看门狗、选择输入时钟源、使能/关闭中断、使能/关闭输出  
  - 看门狗定时器数据寄存器WTDAT
    - 用于设置看门狗定时器的初值，值会加载到WTCNT
  - 看门狗计时器/计数器寄存器WTCNT
    - 为看门狗定时器的计数器，它的值表示该定时器的当前计数值，就是到下一次溢出还需要经历的时钟数

#### 4.2 嵌入式系统的存储体系

##### 1、存储器系统：存储器系统的层次结构\*

> 4.2.1存储器系统：存储器系统的层次结构\*
>
> 4.2.2 ROM的种类与选型
>
> 4.2.3 Flash的种类与选型
>
> 4.2.4 RAM的种类与选型
>
> 4.2.5 Cache-

#### 4.3 嵌入式系统总线

##### 1、总线结构，常见的总线及特点

- 单总线结构：使用一条单一的系统总线来连接CPU、主存和I/O设备。总线只能分时工作，吞吐量受限制
- 双总线结构：CPU和主存之间专门设置一组高速的存储总线，使得CPU可通过**专用总线**与存储器交换信息，减轻了**系统总线**的负担。主存仍可通过**系统总线与外设**之间实现DMA操作，不必经过CPU
- 三总线结构：在双总线基础上增加I/O总线。**系统总线**是**CPU、主存和通道**之间进行数据传输的公共通路，**I/O总线**是多个外部设备与通道之间进行数据传输的公共通路。这个通道其实是一台**特殊功能的处理器**，分担了一部分CPU功能，实现对外设的**统一管理**和外设与主存之间的**数据传送**

##### 2、输入输出编程：忙等IO和中断IO\*

- 忙等效率比较低，CPU在等待设备的时候不能做其他工作，无法同步进行输入输出
- 中断IO允许设备更改CPU控制流

Ref: 嵌入式计算系统设计原理。Arduino相关文档与著作

### 五、嵌入式系统软件知识

#### 5.1 嵌入式软件基础知识

##### 1、嵌入式软件的分类

- （系统软件、支撑软件、应用软件）
- 不知道有没有内容，未完待续

##### 2、嵌入式软件体系结构\*\*

- 驱动层
  - 板级初始化程序
  - 与系统软件相关的驱动
  - 与应用软件相关的驱动
  - 与应用软件相关的驱动不一定需要和操作系统连接，这些驱动的设计和开发由应用决定
- 操作系统层
  - 操作系统层包括：嵌入式内核、嵌入式TCP/IP网络系统、嵌入式文件系统、嵌入式GUI系统和电源管理等部分
  - 嵌入式内核是基础和必备的部分，其他部分要根据需要确定
- 中间件层
  - 目前在一些复杂的嵌入式系统中开始采用中间件技术，主要包括嵌入式java、嵌入式DCOM和面向应用领域的中间件软件
  - 如基于嵌入式CORBA的应用于软件无线电台的应用中间件SCA (Software Core Architecture)
- 应用层
  - 应用层软件主要由多个相对独立的应用任务组成
  - 每个应用任务完成特定的工作，如：I/O任务、计算任务、通信任务等，由操作系统调度各个任务的运行

#### 5.2 嵌入式操作系统基础知识

##### 1、RTOS概念、特点、选型原则（商业化RTOS）\*

- RTOS定义：对外来事件能在限定响应时间内做出预定质量处理的计算机系统
- 特点：可移植性、强调实时性能、内核精简、抢占式内核、使用可重入函数、可配置、可裁剪、高可靠性
- 举例：μC/OS-II，VxWorks，Linux/RT，FreeRTOS  
- 选型原则：综合权衡
  - 成本、可靠性、实时性、工具链
  - 模块丰富、RTOS内核RAM/ROM占用量、支持

##### 2、任务管理

- 进程、线程、任务的概念
- 任务的实现（任务的层次结构、任务控制块、任务的状态及状态转换、任务队列）
- 任务调度（可抢占调度、不可抢占调度、先来先服务、时间片轮转算法、优先级算法）
- 实时系统及任务调度（RMS、EDF算法）\*\*
- 任务间通信（共享内存、消息、管道、信号）

- 同步与互斥（竞争条件、临界区、互斥、信号量、死锁）

##### 3、存储管理

- 嵌入式系统静态和动态内存管理\*
  - 整合到后面ucOS的静态和动态内存管理

#### 5.3 嵌入式系统程序设计（不考）

##### 1、嵌入式软件开发环境：交叉开发（宿主机、目标机）\*

- 软件开发在宿主机（通常PC）上，目标机用于运行软件
  - 利用宿主机丰富的资源和良好的开发环境，开发和调试目标机上的软件
  - 通过串口或者以太网连接，将交叉编译生成的目标代码装载到目标机上
  - 在监控程序或者操作系统的支持下，用交叉调试器分析和调试
  - 最后目标机在特定环境下脱离宿主机单独运行

### 六、嵌入式实时内核（结合ucOS-II和freertos）

实时任务调度、中断与时钟、同步与通信、存储管理（静态、动态）\*

### 七、bsp, bootloader

> 嵌入式系统的启动过程
>
> bsp，特点，与bios，EFI区别
>
> 引导模式\*
>
> bootloader及其启动过程

### 八、建模\*\*

有限状态机及其应用。

有限状态机的实现。



二、考试形式：闭卷，笔试

基本概念、基本原理、设计应用技术

范围：以课件涵盖内容为主，重点在于授课时涉及的内容。

三、题型：

1\. 简答题（50）

2\. 问答题（30）

3\. 设计题（20）


