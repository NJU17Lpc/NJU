- 数据量很大，兼顾实务操作和分析操作在性能上越来越不可能。于是OLAP出来了

#### 1、OLAP是什么

- OLAP（联机分析处理）是针对特定问题的联机数据访问和分析。

- 通过对信息（这些信息已经从原始的数据进行了转换，以反映用户能理解的企业的真实的“维”）的很多种可能的观察形式，进行快速、稳定一致和交互性的存取，允许管理决策人员对数据进行深入观察

#### 2、OLAP vs. OLTP

|            | OLAP                   | OLTP               |
| ---------- | ---------------------- | ------------------ |
| 应用基础   | 数据仓库               | DBMS               |
| 用户       | 决策者                 | 一般操作员         |
| 目的       | 为决策和管理提供支持   | 为日常工作服务     |
| 数据特征   | 导出数据               | 原始数据           |
| 数据细节   | 综合性数据，细节程度低 | 细节程度高         |
| 时间特征   | 历史数据，横跨一个时段 | 当前数据           |
| 更新方法   | 周期性刷新             | 可实时更新         |
| 数据量需求 | 一次处理需大量数据     | 一次处理需少量数据 |

#### 3、OLAP中几个基本概念

##### 度量值

- 在**分析型**处理中，我们所**关心和分析的对象**
- 多维数据集中，度量值是一组值，**通常是数字值**
- 度量值是所分析的多维数据集的中心值，是最终用户浏览数据集时**重点查看的数值型数据**
- 度量值的选择取决于最终用户请求的信息类型
- 常见有销售金额、成本金额、库存数量等

##### 维

- **观察度量值的角度**
- 例如可以从时间维、商品维、地域维观察“销售金额”这个度量值
  - 从时间角度统计不同时间段的销售金额，或者根据商品分类统计每一类的销售金额

##### 层

- 分析型应用中，对**度量值**可以在**不同的深度上**分析和观察，可能得到不同的分析结果
- “层”**反映了对度量值的观察深度**
- 一般，“层”与“维”是相关联的，一个维中可允许若干层。元数据需要记录不同“层”之间的包含关系，便于正确执行统计

##### 维成员

- 维的一个取值，成为该维的一个“维”成员
  - 如果一个维是多层次的，那么维成员可以是**不同层次上取值组合**，也可以是**某个维层次上的取值**
  - 对一个度量值来说，维成员是该度量值在某维中位置的描述

##### 多维数组

- 一个多维数组数组可表示为(维1，维2，...，变量)
  - “变量”是观察的**度量值**
  - 各个维是观察该度量值的**角度**
  - 如(2000年，家电，南京市，5000万)
- 当多维数组的每一维都选中一个维成员，则这些**维成员的组合就唯一确定**了一个度量值
  - 这样一个值就叫**一个“数据单元”**

#### 4、OLAP的数据构造方式

##### ROLAP: Relational OLAP

- 用传统的“**关系数据库管理**系统”（**<u>RDBMS</u>**）管理，将星型或雪花型模式，用二维表形式存储，表间用关键字相连，构成一个关系模式，叫ROLAP
- 其中关系型OLAP服务器和RDBMS之间用SQL存取

##### MOLAP: Multi-Dimensional OLAP

- 用”多维数据库管理系统“管理，而这个多维数据库采用的基本数据模式是“**<u>多维数组</u>**”
- 在MOLAP中，“事实表”表示成一个多维数组
  - “维”属性值：多维数组的下标
  - “度量值”：多维数组的取值，存储在数据单元中
  - 可**通过下标的取值，找到相应的度量值**

##### 混合联机分析处理 HOLAP

- 试图将MOLAP和ROLAP进行**融合**，从而在**大量数据上获得高效率**
- 方式
  - 同时提供多维数据库(MDDB)和关系数据库(RDB)
  - 将RDB的查询结果存储到MDDB
  - 使用MDDB存储高层次数据，RDB存储细节数据

##### 对比MOLAP和ROLAP

| MOLAP                                                        | ROLAP                                                        |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| 专为OLAP设计                                                 | 沿用现有的关系数据库的技术                                   |
| 性能好、**响应速度快**                                       | **响应速度**比MOLAP**慢**                                    |
| 数据**装载速度慢**                                           | 数据**装载速度快**                                           |
| 需要进行预计算，可能导致数据爆炸，**维度有限**；**无法支持维的动态变化** | 存储空间耗费小，维数没有限制                                 |
| 受到操作系统平台中文件大小的限制，很难达到TB级别             | 借用RDBMS存储数据，没有文件大小限制                          |
| 缺乏数据模型和数据访问的标准                                 | 可以通过sql实现详细数据和概要数据的存储                      |
| 支持高性能的决策支持计算，复杂的跨维计算，多用户的读写操作，行级的计算 | 不支持有关预计算的读写操作，sql无法完成部分计算；无法完成多行的计算；无法完成维之间的计算 |
| 管理简便                                                     | 维护困难                                                     |

##### OLAP需解决的问题

- 就是要提高对OLAP数据的访问效率
  - 目前有很多方法
    - 物化视图
    - 特殊的索引和集簇方式，加速星型模式内表的连接
    - 尽量采用并行操作
    - 采用OLAP中查询优化技术
    - 采用增量技术，即OLAP数据更新时，保留不变的数据，只更新变动的数据

#### 5、OLAP的基本数据模型

##### MOLAP: 使用MDDB:多维数据库

- 数据多维形式存放和展现
- 多维数组比关系数据表，**表达更清晰**，处理**稠密数据时占用存储小**
- **适用于**需要**高速处理的复杂分析**
- **维护**多维数组需要**大量资源**
- 多维数据库存取时，要注意
  - 这是由经过压缩的、类似于数组的对象构成的。带有**高度压缩**的**索引**以及**指针结构**
  - 并**不是**维间的**每种维成员组合**，都对应**合理的度量值**
  - MDDB具有高效的稀疏数据处理能力，就是略过零元、缺失、重复
  - 多维查询使用**MDSQL**

##### ROLAP: 常用两种数据模型：星型、雪花

- 使用通用的**关系数据库**来存储需要的数据
- **适应**于处理**大量数据**，但**低效率**
- 现有的RDBMS对OLAP做了很多优化，包括并行存储、查询、数据管理，SQL的OLAP扩展(cube)等，性能有所提高

###### 星型模式

- 是一种**多维表**结构，由两种不同性质的**二维表**组成
  - 事实表：存放多维表中的主要事实，“**<u>度量值</u>**”
  - 维表：存放多维表中维成员的取值
  - n维的多维表往往有**n个维表和一个事实表**，构成一个星型的结构
    - 主体是事实表，维的细节放在维表之中，从而简化事实表
    - 事实表和维表之间的**公共属性**让他们构成一个整体

###### 雪花模式

- 是对星型模式的扩展，进一步层次化
  - 原有的各个维表可能扩展为**小的事实表**，形成**局部的层次区域**
  - 优点
    - 使得维表尽可能**规范化**，最大限度**减少维表的数据存储量**
  - 缺点
    - 执行查询时需要**更多的连接**操作，可能会影响**查询性能**

###### 其他扩展模式

- 星座模式：通过公共维度连接多个星型模式
- 雪暴模式：通过公共维度连接多个雪花模式

#### 6、数据立方体

现在的问题：

- 数据仓库的数据模式可以看成定义在多个数据源上的数据视图，**其中存储的分析型数据通常是经过统计而获得的综合性数据**
  - 而获得这些**综合型数据**是要通过**时间开销**很大的**统计函数**

解决方法：**物化视图**

- **预先计算**好数据视图的**统计信息**，并**存在数据仓库**中----将**虚的视图转变为实际的视图**
- 存放物化视图的三维数据模型叫**数据立方体**

数据超立方体

- 分析应用对象超过三维的时候，构建n维立方体

方体格

- n维方体称为基本方体 base cuboid
- 0维方体代表最高层次的抽象，称为顶点方体 all: apex cuboid
- 方体格构成数据立方体

星型网查询模式

- 每个circle叫做footprint

数据立方体的物化

- 不进行物化
- 全物化
- 部分物化
  - 确定要物化的方体子集
  - 利用查询处理时物化的方体
  - 在装入和刷新时，有效地更新物化的方体

#### 7、Multiway Array Aggregation

- 就是把多维数组文件分割成可以放进内存的chunks
  - 用(chunk_id, offset)来表示
  - 我们想要用一个多路聚合的遍历方法，从而减少访问内存和存储开销
  - 获取chunk的原则是：按照基数从小到大的维度
    - 对于4 4 4的立方体，各个dimension分别为10 100 1000
    - 于是先100x1000，再40x1000，最后40x400

#### 8、多维数据分析

- 指的是对以多维形式组织起来的数据，采取**切片、切块、旋转、钻取**等各种**分析动作**，从而剖析数据，使得用户能从**多个角度、多个侧面观察**数据，深入了解包含在数据中的信息、内涵
- 基本操作
  - 切片
    - 根据某一维上的，某个**维成员取值**，选择统计数据进行分析
  - 切块
    - 根据某一维上的，某个**维成员取值区间**，选择统计数据进行分析
    - 根据多个维度上的，**维成员取值区间**，选择统计数据进行分析
  - 旋转
    - 调整维的排列次序的动作
  - 上钻/数据概括(roll up)
    - 将多维下标的取值提升到较高的概念层次上，形成新的统计查询结果，并进行分析
  - 下钻/数据细化(drill down)
    - 将多维下标的取值降低到较低的概念层次上，形成更细致的统计查询结果，并进行分析
- 其他操作
  - 跨钻(drill across)
    - 对多个事实进行操作
  - 钻透(drill through)
    - 下钻到数据量立方体的最低细节后，继续细化到数据仓库/数据库的关系型表格







































